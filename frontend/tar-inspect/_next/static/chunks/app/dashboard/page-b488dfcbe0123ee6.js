(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{1044:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var r=s(5155),a=s(2115),l=s(2619),n=s.n(l),o=s(1312),i=s(2983),c=s(3998);function d(){let e=(0,i.A)();return e.ready&&"web3"===e.kind&&"parent-bound"!==e.postAuth&&e.signCapabilityNow?(0,r.jsxs)("div",{className:"rounded border p-3 bg-amber-50/60 space-y-2",children:[(0,r.jsx)("div",{className:"text-sm",children:"Enable posting by authorizing a safe key with your wallet."}),(0,r.jsx)(c.$,{onClick:e.signCapabilityNow,children:"Authorize (EIP-712)"})]}):null}var u=s(6329);function x(){var e,t;let s=(0,i.A)(),[l,c]=(0,a.useState)(null),x=(0,a.useMemo)(()=>{var e;return s.ready?(e="web3"===s.kind?s.parent:s.safe)&&/^0x[0-9a-fA-F]{40}$/.test(e)?e:null:null},[s.ready,s.kind,s.parent,s.safe]),m=s.ready&&"web3"===s.kind&&"parent-bound"!==s.postAuth;return(0,a.useEffect)(()=>{try{let e=localStorage.getItem("woco.owner0x");e&&e.startsWith("0x")&&c(t=>null!=t?t:e)}catch(e){}let e=()=>{try{let e=localStorage.getItem("woco.owner0x");e&&e.startsWith("0x")&&c(t=>t===e?t:e)}catch(e){}};return window.addEventListener("owner:refreshed",e),()=>window.removeEventListener("owner:refreshed",e)},[]),(0,a.useEffect)(()=>{if(s.ready)try{x?localStorage.setItem("woco.subject0x",x):localStorage.removeItem("woco.subject0x"),l&&localStorage.setItem("woco.owner0x",l)}catch(e){}},[s.ready,x,l]),(0,r.jsxs)("main",{className:"min-h-dvh bg-neutral-50 pb-20",children:[(0,r.jsx)("header",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur border-b",children:(0,r.jsxs)("div",{className:"mx-auto max-w-3xl px-4 h-14 flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Devconnect"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(n(),{href:"/account",className:"text-sm underline",children:"Accounts"}),(0,r.jsx)(n(),{href:"/profile",className:"text-sm underline",children:"Edit profile"}),(0,r.jsx)(n(),{href:"/forum",className:"text-sm underline",children:"Forum"})]})]})}),(0,r.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-6",children:[m&&(0,r.jsx)("div",{className:"rounded-xl border p-3 bg-amber-50/70 text-sm mb-2","aria-live":"polite",children:"Authorizing… please confirm in your wallet."}),(0,r.jsxs)("section",{className:"rounded-xl bg-white border shadow-sm p-4 space-y-1",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Account"}),(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:["Subject (user):"," ",(0,r.jsx)("code",{className:"break-all",children:null!=x?x:"(no active account — go to Login to get started)"})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:["Feed owner (platform signer):"," ",(0,r.jsx)("code",{className:"break-all",children:null!=l?l:"(loading…)"})]}),"web3"===s.kind&&(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Debug \xb7 parent: ",(0,r.jsx)("code",{children:null!=(e=s.parent)?e:"(unset)"})," \xb7 safe: ",(0,r.jsx)("code",{children:null!=(t=s.safe)?t:"(unset)"})," \xb7 postAuth: ",(0,r.jsx)("code",{children:s.postAuth})]}),"web3"===s.kind&&(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:["Posting: ","parent-bound"===s.postAuth?"enabled":"requires authorization"]})]}),(0,r.jsxs)("section",{className:"rounded-xl bg-white border shadow-sm p-4",children:[(0,r.jsx)("div",{className:"mb-3 text-sm font-semibold",children:"My Profile"}),l&&x?(0,r.jsx)(o.A,{feedOwner:l,subject:x},x):(0,r.jsx)("div",{className:"text-sm text-gray-500",children:s.ready?x?"Loading platform signer…":"No active user found. Use the Login page to start.":"Preparing your account…"}),(0,r.jsxs)("p",{className:"mt-2 text-xs text-gray-500 break-all",children:["Viewing profile for: ",(0,r.jsx)("code",{children:null!=x?x:"(no subject)"})," \xb7 ","feed owner: ",(0,r.jsx)("code",{children:null!=l?l:"(unknown)"})]}),"web3"===s.kind&&"parent-bound"!==s.postAuth&&(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsx)(d,{})})]}),(0,r.jsxs)("section",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)(n(),{href:"/programme",className:"rounded-xl bg-white border shadow-sm p-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:"Programme"}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Browse sessions & schedule"})]}),(0,r.jsxs)(n(),{href:"/map",className:"rounded-xl bg-white border shadow-sm p-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:"Map"}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Find venues & rooms"})]}),(0,r.jsxs)(n(),{href:"/forum",className:"rounded-xl bg-blue-600 border border-blue-700 shadow-md p-4 hover:bg-blue-700 transition",children:[(0,r.jsx)("div",{className:"text-sm font-bold text-white",children:"Forum"}),(0,r.jsx)("div",{className:"text-xs text-blue-100",children:"Discuss sessions & speakers"})]}),(0,r.jsxs)(n(),{href:"/profile",className:"rounded-xl bg-blue-600 border border-blue-700 shadow-md p-4 hover:bg-blue-700 transition",children:[(0,r.jsx)("div",{className:"text-sm font-bold text-white",children:"Settings"}),(0,r.jsx)("div",{className:"text-xs text-blue-100",children:"Update your profile"})]})]}),(0,r.jsxs)("section",{className:"rounded-xl bg-white border shadow-sm p-4",children:[(0,r.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Testing"}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"“Forget identity” clears your local posting key/capability and returns to the Login screen."}),(0,r.jsx)("button",{className:"inline-flex items-center justify-center rounded-lg bg-black px-4 py-2 text-white",onClick:async()=>{try{await s.logout();try{await fetch((0,u.apiUrl)("/api/auth/logout"),{method:"POST"})}catch(e){}try{localStorage.removeItem("woco.active_pk"),localStorage.removeItem("demo_user_pk")}catch(e){}window.dispatchEvent(new Event("admin:changed")),window.dispatchEvent(new Event("profile:updated")),setTimeout(()=>{location.href="/"},0)}catch(e){console.error("forget identity failed",e)}},children:"Forget identity (testing)"})]})]})]})}},1312:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(5155),a=s(5239),l=s(2115),n=s(43),o=s(8701);function i(e){var t,s,i;let{subject:c,feedOwner:d}=e,{profile:u,ensureFresh:x}=(0,n.x)(),m=(0,l.useRef)(x);(0,l.useEffect)(()=>{m.current=x},[x]);let h=(0,l.useRef)(null==u?void 0:u.avatarMarker),[b,f]=(0,l.useState)(!1);(0,l.useEffect)(()=>{f(!1)},[null==u?void 0:u.avatarRef,null==u?void 0:u.avatarMarker]);let g=(0,l.useRef)(null),v=(0,l.useRef)(!1),p=(0,l.useRef)(0);(0,l.useEffect)(()=>{let e="".concat(null!=c?c:"nosub","|").concat(null!=d?d:"noown");if(g.current===e||(g.current=e,h.current))return;let t=Date.now();if(t-p.current<1e3||(p.current=t,v.current))return;v.current=!0;let s=setTimeout(async()=>{try{await m.current()}finally{v.current=!1}},250);return()=>clearTimeout(s)},[c,d]);let w=null!=(t=null==u?void 0:u.name)?t:null,j=null!=(s=null==u?void 0:u.avatarRef)?s:null,N=j?j.toLowerCase().replace(/\/+$/,""):null,y=(0,l.useMemo)(()=>{if(!N)return null;let e=(null==u?void 0:u.avatarMarker)?"?v=".concat(u.avatarMarker):"";return"".concat(o.b,"/bzz/").concat(N).concat(e)},[N,null==u?void 0:u.avatarMarker]);return console.log("[ProfileView] avatarRef =",j,"→ avatarSrc =",y),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[y&&!b?(0,r.jsx)(a.default,{src:y,alt:"avatar",width:80,height:80,unoptimized:!0,className:"w-20 h-20 rounded-full object-cover border",onError:()=>f(!0)},"".concat(N,"-").concat(null!=(i=null==u?void 0:u.avatarMarker)?i:"0")):(0,r.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-200 border"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lg font-semibold",children:null!=w?w:"(no name yet)"}),(0,r.jsx)("div",{className:"text-xs text-gray-500 break-all",children:c}),d&&(0,r.jsxs)("div",{className:"text-[10px] text-gray-400 break-all",children:["owner: ",d]})]})]})}},6534:(e,t,s)=>{Promise.resolve().then(s.bind(s,1044))}},e=>{e.O(0,[993,149,239,619,452,526,441,493,358],()=>e(e.s=6534)),_N_E=e.O()}]);