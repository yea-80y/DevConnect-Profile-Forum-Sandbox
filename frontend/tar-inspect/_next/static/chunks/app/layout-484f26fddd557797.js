(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{43:(e,t,r)=>{"use strict";r.d(t,{H:()=>v,x:()=>d});var n=r(5155),l=r(2115),a=r(6149),i=r(5373),o=r(73);function u(e){let t=0x811c9dc5;for(let r=0;r<e.length;r++)t^=e[r],t=t+(t<<1>>>0)+(t<<4>>>0)+(t<<7>>>0)+(t<<8>>>0)+(t<<24>>>0)>>>0;return t.toString(16).padStart(8,"0")}function s(e){if(!e)return null;try{let t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}async function c(e){let{beeUrl:t,feedOwner:r,subject:n,prev:l}=e,c=new a.VL(t),f=n.slice(2).toLowerCase(),d=a.KK.fromString("".concat(i.l4,"/name/").concat(f)),v=a.KK.fromString("".concat(i.l4,"/avatar/").concat(f)),m={beeUrl:t,subject:n,feedOwner:r,name:null==l?void 0:l.name,avatarRef:null==l?void 0:l.avatarRef,nameMarker:null==l?void 0:l.nameMarker,avatarMarker:null==l?void 0:l.avatarMarker};try{let e=(await c.makeFeedReader(d,r).downloadPayload()).payload.toUtf8(),t=u(new TextEncoder().encode(null!=e?e:""));if(t!==(null==l?void 0:l.nameMarker)){let r=s(e);m.name=r&&"string"==typeof r.name?r.name:e&&"string"==typeof e?e:void 0,m.nameMarker=t}}catch(e){}try{let e=(await c.makeFeedReader(v,r).downloadPayload()).payload.toUtf8(),t=u(new TextEncoder().encode(null!=e?e:""));if(t!==(null==l?void 0:l.avatarMarker)){let r=s(e),n=(0,o.cX)(null!=r?r:e);m.avatarRef=null!=n?n:null==l?void 0:l.avatarRef,m.avatarMarker=t}}catch(e){}return m.name!==(null==l?void 0:l.name)||m.avatarRef!==(null==l?void 0:l.avatarRef)||m.nameMarker!==(null==l?void 0:l.nameMarker)||m.avatarMarker!==(null==l?void 0:l.avatarMarker)||m.beeUrl!==(null==l?void 0:l.beeUrl)?m:l}let f=(0,l.createContext)(null);function d(){let e=(0,l.useContext)(f);if(!e)throw Error("useProfile must be used within <ProfileProvider>");return e}function v(e){let{children:t,subject:r,feedOwner:a,beeUrl:i}=e,[o,u]=(0,l.useState)(null),s=(0,l.useMemo)(()=>r&&a?"profile:".concat(a,":").concat(r):null,[r,a]);(0,l.useEffect)(()=>{if(!s)return void u(null);try{let e=localStorage.getItem(s);if(!e)return void u(null);let t=JSON.parse(e);(null==t?void 0:t.subject)===r&&(null==t?void 0:t.feedOwner)===a?u(t):u(null)}catch(e){u(null)}},[s,r,a]),(0,l.useEffect)(()=>{if(s&&o)try{localStorage.setItem(s,JSON.stringify(o))}catch(e){}},[s,o]);let d=(0,l.useRef)(!1),v=(0,l.useRef)(0),m=(0,l.useCallback)(async()=>{if(r&&a&&!d.current){d.current=!0;try{let e=await c({beeUrl:i,feedOwner:a,subject:r,prev:o});e&&e!==o&&u(e),v.current=Date.now()}finally{d.current=!1}}},[i,a,r,o]);(0,l.useEffect)(()=>{let e=!1;return(async()=>{if(r&&a&&(await m(),e))return})(),()=>{e=!0}},[r,a,m]),(0,l.useEffect)(()=>{if(!r||!a)return;let e=async()=>{"visible"===document.visibilityState&&(Date.now()-v.current<12e4||await m())};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[r,a,m]);let w=(0,l.useCallback)(e=>{u(t=>({...null!=t?t:{beeUrl:i,subject:r,feedOwner:a},...e}))},[i,r,a]),y=(0,l.useRef)({subject:null,feedOwner:null});(0,l.useEffect)(()=>{let e=y.current;(e.subject!==r||e.feedOwner!==a)&&null!==e.subject&&(u(null),m()),y.current={subject:r,feedOwner:a}},[r,a,m]);let h=(0,l.useMemo)(()=>({profile:o,ensureFresh:m,applyLocalUpdate:w}),[o,m,w]);return(0,n.jsx)(f.Provider,{value:h,children:t})}},73:(e,t,r)=>{"use strict";r.d(t,{F1:()=>c,FQ:()=>w,YT:()=>a,cX:()=>s,yU:()=>m});var n=r(6329);function l(e){return!!e&&"object"==typeof e}function a(e){if(!e)return null;let t=e.toLowerCase().replace(/^0x/,"");return t&&/^[0-9a-fA-F]{64}$/.test(t)?t:null}function i(e){return!!e&&/^0x[0-9a-fA-F]{40}$/.test(e)}function o(e){let t=e.toLowerCase().match(/([0-9a-f]{64})/);return t?t[1]:null}function u(e){let t=function e(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("string"==typeof t){let e=r.join(".").toLowerCase(),l=a(t),i=null!=l?l:o(t);if(i){let t=0;e.includes("avatarref")&&(t+=200),(e.endsWith(".avatar.ref")||e.includes(".avatar.ref"))&&(t+=180),e.includes("avatar")&&(t+=150),e.includes("profile")&&(t+=25),(e.includes("current")||e.includes("latest"))&&(t+=15),e.endsWith(".ref")&&(t+=2),l||(t-=5),n.push({ref:i,score:t,path:r.join(".")})}return n}if(Array.isArray(t)){for(let l=0;l<t.length;l++)e(t[l],[...r,String(l)],n);return n}if(l(t))for(let[l,a]of Object.entries(t))e(a,[...r,l],n);return n}(e);return t.length?(t.sort((e,t)=>{if(t.score!==e.score)return t.score-e.score;let r=Number(e.path.toLowerCase().includes("avatar"));return Number(t.path.toLowerCase().includes("avatar"))-r}),t[0].ref):null}function s(e){if(l(e)){let t=a(e.avatarRef);if(t)return t;let r=e.avatar;if(l(r)){let e=a(r.ref);if(e)return e;let t=r.src;if("string"==typeof t){let e=o(t);if(e)return e}let n=r.url;if("string"==typeof n){let e=o(n);if(e)return e}}let n=e.profile;if(l(n)){let e=a(n.avatarRef);if(e)return e;let t=n.avatar;if(l(t)){let e=a(t.ref);if(e)return e;let r=t.src;if("string"==typeof r){let e=o(r);if(e)return e}let n=t.url;if("string"==typeof n){let e=o(n);if(e)return e}}let r=n.avatarSrc;if("string"==typeof r){let e=o(r);if(e)return e}let i=n.avatarUrl;if("string"==typeof i){let e=o(i);if(e)return e}}let i=e.avatarSrc;if("string"==typeof i){let e=o(i);if(e)return e}let u=e.avatarUrl;if("string"==typeof u){let e=o(u);if(e)return e}}return u(e)}function c(e){return u(e)}async function f(e){try{let t=null==e?void 0:e.trim().toLowerCase();if(!i(t))return null;for(let e of["owner","subject","address","addr","wallet","id"]){let r=(0,n.apiUrl)("/api/profile?".concat(e,"=").concat(encodeURIComponent(t)));try{let e=await fetch(r,{cache:"no-store"});if(!e.ok)continue;let t=await e.json(),n=u(t);if(n)return n}catch(e){}}return null}catch(e){return null}}let d=new Map,v=new Map;function m(e){let t=null==e?void 0:e.toLowerCase();if(!i(t))return Promise.resolve(null);if(d.has(t))return Promise.resolve(d.get(t));let r=v.get(t);if(r)return r;let n=f(t).then(e=>(d.set(t,null!=e?e:null),v.delete(t),null!=e?e:null)).catch(()=>(v.delete(t),null));return v.set(t,n),n}function w(e){e.forEach(e=>{m(e)})}},1565:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},3673:()=>{},3807:(e,t,r)=>{"use strict";r.d(t,{default:()=>f,y:()=>c});var n=r(5155),l=r(2115),a=r(43),i=r(2983),o=r(6329);let u="woco.owner0x",s=(0,l.createContext)({isAdmin:!1,address:null});function c(){return(0,l.useContext)(s)}function f(e){let{children:t}=e,[r,c]=(0,l.useState)(null),[f,d]=(0,l.useState)(0),[v,m]=(0,l.useState)({isAdmin:!1,address:null}),w=(0,i.A)(),y=(0,l.useMemo)(()=>{if(!w.ready)return null;let e="web3"===w.kind?w.parent:w.safe;return e&&/^0x[0-9a-fA-F]{40}$/.test(e)?e:null},[w.ready,w.kind,w.parent,w.safe]),h="".concat(null!=y?y:"nosub","|").concat(f),p=r&&/^0x[0-9a-fA-F]{40}$/.test(r)?r:null;return(0,l.useEffect)(()=>{try{let e=localStorage.getItem(u);e&&e.startsWith("0x")&&c(t=>null!=t?t:e)}catch(e){}let e=!0;return(async()=>{try{var t,r;let n=await fetch((0,o.apiUrl)("/api/profile"),{cache:"no-store",credentials:"include"}),l=await n.json();if(!e||!(null==l?void 0:l.ok)||!(null==(r=l.owner)||null==(t=r.startsWith)?void 0:t.call(r,"0x")))return;c(e=>e===l.owner?e:l.owner);try{localStorage.setItem(u,l.owner)}catch(e){}}catch(e){}})(),()=>{e=!1}},[]),(0,l.useEffect)(()=>{let e=!0,t=!1,r=async()=>{if(!t&&e){t=!0;try{for(let t of[0,150,400])try{var r;t&&await new Promise(e=>setTimeout(e,t));let n=await fetch((0,o.apiUrl)("/api/auth/me"),{credentials:"include",cache:"no-store",headers:{...y?{"X-Subject-Address":y}:{}}}),l=await n.json().catch(()=>({}));if(!e)return;m({isAdmin:!!(null==l?void 0:l.isAdmin),address:null!=(r=null==l?void 0:l.address)?r:null});return}catch(e){}}finally{t=!1}}};r();let n=()=>r();return window.addEventListener("admin:changed",n),()=>{e=!1,window.removeEventListener("admin:changed",n)}},[y]),(0,l.useEffect)(()=>{let e=()=>d(e=>e+1);return window.addEventListener("profile:updated",e),()=>window.removeEventListener("profile:updated",e)},[]),(0,n.jsx)(s.Provider,{value:v,children:(0,n.jsx)(a.H,{subject:y,feedOwner:p,beeUrl:"https://gateway.woco-net.com",children:t},h)})}},5373:(e,t,r)=>{"use strict";r.d(t,{l4:()=>n}),r(6149);let n="devconnect/profile"},6197:()=>{},6541:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,9742,23)),Promise.resolve().then(r.t.bind(r,1565,23)),Promise.resolve().then(r.bind(r,3807)),Promise.resolve().then(r.t.bind(r,3673,23))},9742:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}}},e=>{e.O(0,[668,993,149,452,441,493,358],()=>e(e.s=6541)),_N_E=e.O()}]);